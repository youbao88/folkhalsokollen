<!DOCTYPE html>
<head>
    <title>
        Folkhälsokollen läs mer
    </title>
    <style>
        body {
            font-family: Arial;
            background-color: #F5F3F0;
        }
    </style>
</head>
<body>
    <div id = "text_content" style="position:fixed; top: 20%; left: 0%; font-family: Arial, Helvetica, sans-serif;">
    </div>
    <script>
        if (window.addEventListener) {
        // For standards-compliant web browsers
            window.addEventListener("message", onMessage, false);
        } else {
            window.attachEvent("onmessage", onMessage);
        } 
        // Retrieve data and begin processing
        function onMessage(event) {
            if (event && event.data) {
               var div = document.getElementById("text_content");
               var rows = event.data.data;
               if (rows == []){
                   return;
               }
               div.innerHTML = '';
               var indicator_name = rows[0][0];
               div.innerHTML += `<span id = "big_title" style="font-size: 1.1rem; font-weight: bold">${indicator_name}</span>`;
               if (rows[0][1] !== 'Ej valbart'){
                   div.innerHTML += ': ';
                   for(var i = 0; i<rows.length; i++){
                       div.innerHTML += `<span style="font-size: 1.1rem; font-weight: bold">${rows[i][1]}</span>`;
                       if (i < rows.length-1){
                           div.innerHTML += '<span style="font-size: 1.1rem; font-weight: bold">; </span>';
                       }else{
                           div.innerHTML += '<br>';
                       }
                   }
               }else{
                   div.innerHTML += '<br>';
               }
               var parameters = event.data.parameters;
               var advanced_report = false;
               for (var i = 0; i<parameters.length; i++){
                   if(parameters[i]['label'] == "selection_option"){
                       if(parameters[i]['value'] == 'på'){
                           document.getElementById('big_title').innerHTML += ` (avancerad nivå stratifierad av `;
                           advanced_report = true;
                       } 
                    continue;
                    }
                   if(parameters[i]['label'] == "total_social variabel"){
                       if(advanced_report == true){
                           document.getElementById('big_title').innerHTML += `${parameters[i]['value']})`;
                       }
                       continue
                   }
                   var parameter_name = parameters[i]['label'].split('_')[1];
                   div.innerHTML += `<span style = 'font-size: 0.9rem'>${parameter_name}:</span>`;
                   var parameter_value = parameters[i]['value'];

                   if (parameter_name == "Åldersgrupp"){
                       var ålder_interval = [];
                       for(var j= 0; j<parameter_value.length; j++){
                           if (parameter_value[j].charAt(parameter_value[j].length-1) == "+"){  //if the age-group is "XX+", run this
                               ålder_interval.push([parameter_value[j].trim("+"), "+"]);
                           }
                           else{
                               ålder_interval.push(parameter_value[j].trim(" år").split('-'));  //if age-group is "XX-XX år", run this
                           }
                       }

                       var ålder_interval_processed = [];
                       ålder_interval_processed.push(ålder_interval[0]);
                       for(var j=1; j<ålder_interval.length; j++){
                           if (parseInt(ålder_interval[j][0])-1 == ålder_interval_processed[ålder_interval_processed.length-1]){
                               ålder_interval_processed[ålder_interval_processed.length-1][1] = ålder_interval[j][1];
                           }else{
                               ålder_interval_processed.push(ålder_interval[j]);
                           }
                       }
                       console.log(ålder_interval_processed);
                    }
                   if (Array.isArray(parameter_value)){
                        for (var j = 0; j<parameter_value.length; j++){
                            div.innerHTML += `<span style = 'font-size: 0.9rem; font-weight:bold'> ${parameter_value[j]}</span>`;
                            if (j<parameter_value.length-1){
                                div.innerHTML += "<span style = 'font-size: 0.9rem; font-weight:bold'>; </span>"
                            }
                        }
                   }else{
                       div.innerHTML += `<span style = 'font-size: 0.9rem; font-weight:bold'> ${parameter_value}</span>`;
                   }
                   div.innerHTML += '<br>';
               }
               value_unit = rows[0][2];
               div.innerHTML += `<span style="font-size: 0.9rem">Enhet: </span><span style="font-size: 0.9rem; font-weight:bold">${value_unit}`;
            }
        }
    </script>
</body>